package io.newm.server.json

import com.google.common.truth.Truth.assertThat
import io.newm.server.features.collaboration.model.Collaboration
import io.newm.server.features.distribution.model.DistributionOutletReleaseStatusResponse
import io.newm.server.features.distribution.model.GetAlbumResponse
import io.newm.server.features.minting.MintingStatusSqsMessage
import io.newm.shared.serialization.BigDecimalSerializer
import io.newm.shared.serialization.UUIDSerializer
import kotlinx.serialization.json.Json
import kotlinx.serialization.modules.SerializersModule
import org.junit.jupiter.api.Test
import java.math.BigDecimal
import java.util.*

class TestJsonDecoding {
    val json =
        Json {
            ignoreUnknownKeys = true
            explicitNulls = false
            isLenient = true
            serializersModule =
                SerializersModule {
                    contextual(BigDecimal::class, BigDecimalSerializer)
                    contextual(UUID::class, UUIDSerializer)
                }
        }

    @Test
    fun `test BigDecimal json`() {
        val jsonString =
            """{"songId":"7141858a-29bb-4cdf-8e8e-4896f24c133d","email":"tscandalios@newm.io","role":"Artist","royaltyRate":100,"credited":true,"featured":false}"""
        val result: Collaboration = json.decodeFromString(jsonString)
        assertThat(result.royaltyRate).isEqualTo(BigDecimal(100))
    }

    @Test
    fun `test DistributionOutletReleaseStatusResponse json`() {
        val jsonString =
            """{"message":"successfully fetched outlet details","success":true,"data":[{"process_duration_dates":10,"release_start_date":"31-07-2023","store_name":"Outlet Group 1","is_presales_date_enabled":false,"pre_sales_date":"","release_end_date":"","store_id":4393,"outlet_status":{"status_code":1207,"status_name":"Review Pending"},"child_stores":["7 Digital","Digster","Electric Jukebox / Roxi","eMusic","Exlibris","Fan Label","Global Eagle","Global Radio","Grandpad","Jazzed","Klassik Radio","Moodagent","Mus.uy","MuzArcade","MyMelo","NEC","Snap","Songclip (Audiobyte LLC","Soundhound","Soundmouse","Soundtrack","Trebel Music MX/M&M Media","Trebel Music US/M&M Media","Triller","Weltbild Radio","Xite"],"price_code_list":{"album":[],"track":[]},"price_code":{"track_price_id":0,"album_price_id":0}},{"process_duration_dates":10,"release_start_date":"31-07-2023","store_name":"Outlet Group 2","is_presales_date_enabled":false,"pre_sales_date":"","release_end_date":"","store_id":4394,"outlet_status":{"status_code":1207,"status_name":"Review Pending"},"child_stores":["Claro Musica","Contestone/Ringbacktone","iMusica","Now Music A1/Mtel/Vip"],"price_code_list":{"album":[],"track":[]},"price_code":{"track_price_id":0,"album_price_id":0}},{"process_duration_dates":10,"release_start_date":"31-07-2023","store_name":"Outlet Group 3","is_presales_date_enabled":false,"pre_sales_date":"","release_end_date":"","store_id":4395,"outlet_status":{"status_code":1207,"status_name":"Review Pending"},"child_stores":["Bitel","Digicel","Kolbi","Movistar","Orange","Virgin Mobile","Viva","Vodafone"],"price_code_list":{"album":[],"track":[]},"price_code":{"track_price_id":0,"album_price_id":0}},{"process_duration_dates":10,"release_start_date":"31-07-2023","store_name":"Alibaba Xiami","is_presales_date_enabled":false,"pre_sales_date":"","release_end_date":"","store_id":4396,"outlet_status":{"status_code":1207,"status_name":"Review Pending"},"child_stores":[],"price_code_list":{"album":[],"track":[]},"price_code":{"track_price_id":0,"album_price_id":0}},{"process_duration_dates":10,"release_start_date":"31-07-2023","store_name":"Amazon Prime Music","is_presales_date_enabled":false,"pre_sales_date":"","release_end_date":"","store_id":4397,"outlet_status":{"status_code":1207,"status_name":"Review Pending"},"child_stores":["Amazon Ads Supported","Amazon Prime Music","Amazon Unlimited"],"price_code_list":{"album":[],"track":[]},"price_code":{"track_price_id":0,"album_price_id":0}},{"process_duration_dates":10,"release_start_date":"31-07-2023","store_name":"Anghami","is_presales_date_enabled":false,"pre_sales_date":"","release_end_date":"","store_id":4398,"outlet_status":{"status_code":1207,"status_name":"Review Pending"},"child_stores":["Test Store","Test Store"],"price_code_list":{"album":[],"track":[]},"price_code":{"track_price_id":0,"album_price_id":0}},{"process_duration_dates":10,"release_start_date":"31-07-2023","store_name":"Apple Music","is_presales_date_enabled":true,"pre_sales_date":"","release_end_date":"","store_id":4399,"outlet_status":{"status_code":1207,"status_name":"Review Pending"},"child_stores":[],"price_code_list":{"album":[],"track":[]},"price_code":{"track_price_id":0,"album_price_id":0}},{"process_duration_dates":10,"release_start_date":"31-07-2023","store_name":"Apple Shazam","is_presales_date_enabled":false,"pre_sales_date":"","release_end_date":"","store_id":4400,"outlet_status":{"status_code":1207,"status_name":"Review Pending"},"child_stores":[],"price_code_list":{"album":[],"track":[]},"price_code":{"track_price_id":0,"album_price_id":0}},{"process_duration_dates":10,"release_start_date":"31-07-2023","store_name":"AudioMack","is_presales_date_enabled":false,"pre_sales_date":"","release_end_date":"","store_id":4402,"outlet_status":{"status_code":1207,"status_name":"Review Pending"},"child_stores":[],"price_code_list":{"album":[],"track":[]},"price_code":{"track_price_id":0,"album_price_id":0}},{"process_duration_dates":10,"release_start_date":"31-07-2023","store_name":"AWA","is_presales_date_enabled":false,"pre_sales_date":"","release_end_date":"","store_id":4403,"outlet_status":{"status_code":1207,"status_name":"Review Pending"},"child_stores":[],"price_code_list":{"album":[],"track":[]},"price_code":{"track_price_id":0,"album_price_id":0}},{"process_duration_dates":10,"release_start_date":"31-07-2023","store_name":"Deezer","is_presales_date_enabled":false,"pre_sales_date":"","release_end_date":"","store_id":4404,"outlet_status":{"status_code":1207,"status_name":"Review Pending"},"child_stores":[],"price_code_list":{"album":[],"track":[]},"price_code":{"track_price_id":0,"album_price_id":0}},{"process_duration_dates":10,"release_start_date":"31-07-2023","store_name":"Facebook","is_presales_date_enabled":false,"pre_sales_date":"","release_end_date":"","store_id":4405,"outlet_status":{"status_code":1207,"status_name":"Review Pending"},"child_stores":[],"price_code_list":{"album":[],"track":[]},"price_code":{"track_price_id":0,"album_price_id":0}},{"process_duration_dates":10,"release_start_date":"31-07-2023","store_name":"Gaana","is_presales_date_enabled":false,"pre_sales_date":"","release_end_date":"","store_id":4406,"outlet_status":{"status_code":1207,"status_name":"Review Pending"},"child_stores":[],"price_code_list":{"album":[],"track":[]},"price_code":{"track_price_id":0,"album_price_id":0}},{"process_duration_dates":10,"release_start_date":"31-07-2023","store_name":"iHeartRadio","is_presales_date_enabled":false,"pre_sales_date":"","release_end_date":"","store_id":4407,"outlet_status":{"status_code":1207,"status_name":"Review Pending"},"child_stores":[],"price_code_list":{"album":[],"track":[]},"price_code":{"track_price_id":0,"album_price_id":0}},{"process_duration_dates":10,"release_start_date":"31-07-2023","store_name":"Jaxsta","is_presales_date_enabled":false,"pre_sales_date":"","release_end_date":"","store_id":4408,"outlet_status":{"status_code":1207,"status_name":"Review Pending"},"child_stores":[],"price_code_list":{"album":[],"track":[]},"price_code":{"track_price_id":0,"album_price_id":0}},{"process_duration_dates":10,"release_start_date":"31-07-2023","store_name":"JioSaavn","is_presales_date_enabled":false,"pre_sales_date":"","release_end_date":"","store_id":4409,"outlet_status":{"status_code":1207,"status_name":"Review Pending"},"child_stores":[],"price_code_list":{"album":[],"track":[]},"price_code":{"track_price_id":0,"album_price_id":0}},{"process_duration_dates":10,"release_start_date":"31-07-2023","store_name":"KKBOX","is_presales_date_enabled":false,"pre_sales_date":"","release_end_date":"","store_id":4410,"outlet_status":{"status_code":1207,"status_name":"Review Pending"},"child_stores":["J:COM","KDDI","KKBOX"],"price_code_list":{"album":[],"track":[]},"price_code":{"track_price_id":0,"album_price_id":0}},{"process_duration_dates":10,"release_start_date":"31-07-2023","store_name":"Line Music","is_presales_date_enabled":false,"pre_sales_date":"","release_end_date":"","store_id":4411,"outlet_status":{"status_code":1207,"status_name":"Review Pending"},"child_stores":[],"price_code_list":{"album":[],"track":[]},"price_code":{"track_price_id":0,"album_price_id":0}},{"process_duration_dates":10,"release_start_date":"31-07-2023","store_name":"MixCloud","is_presales_date_enabled":false,"pre_sales_date":"","release_end_date":"","store_id":4412,"outlet_status":{"status_code":1207,"status_name":"Review Pending"},"child_stores":[],"price_code_list":{"album":[],"track":[]},"price_code":{"track_price_id":0,"album_price_id":0}},{"process_duration_dates":10,"release_start_date":"31-07-2023","store_name":"MusicJet","is_presales_date_enabled":false,"pre_sales_date":"","release_end_date":"","store_id":4413,"outlet_status":{"status_code":1207,"status_name":"Review Pending"},"child_stores":[],"price_code_list":{"album":[],"track":[]},"price_code":{"track_price_id":0,"album_price_id":0}},{"process_duration_dates":10,"release_start_date":"31-07-2023","store_name":"Napster","is_presales_date_enabled":false,"pre_sales_date":"","release_end_date":"","store_id":4414,"outlet_status":{"status_code":1207,"status_name":"Review Pending"},"child_stores":["BMW","Huawei Music","Mora Qualitas","Napster","Rakuten","SFR","SONOS","Telefonica","Vivo"],"price_code_list":{"album":[],"track":[]},"price_code":{"track_price_id":0,"album_price_id":0}},{"process_duration_dates":10,"release_start_date":"31-07-2023","store_name":"NetEase Cloud Music","is_presales_date_enabled":false,"pre_sales_date":"","release_end_date":"","store_id":4415,"outlet_status":{"status_code":1207,"status_name":"Review Pending"},"child_stores":[],"price_code_list":{"album":[],"track":[]},"price_code":{"track_price_id":0,"album_price_id":0}},{"process_duration_dates":10,"release_start_date":"31-07-2023","store_name":"Nuuday","is_presales_date_enabled":false,"pre_sales_date":"","release_end_date":"","store_id":4416,"outlet_status":{"status_code":1207,"status_name":"Review Pending"},"child_stores":["Child store new","Telmore","YouSee"],"price_code_list":{"album":[],"track":[]},"price_code":{"track_price_id":0,"album_price_id":0}},{"process_duration_dates":10,"release_start_date":"31-07-2023","store_name":"Qobuz","is_presales_date_enabled":false,"pre_sales_date":"","release_end_date":"","store_id":4417,"outlet_status":{"status_code":1207,"status_name":"Review Pending"},"child_stores":["Child store "],"price_code_list":{"album":[],"track":[]},"price_code":{"track_price_id":0,"album_price_id":0}},{"process_duration_dates":10,"release_start_date":"31-07-2023","store_name":"SiriusXM Pandora","is_presales_date_enabled":false,"pre_sales_date":"","release_end_date":"","store_id":4418,"outlet_status":{"status_code":1207,"status_name":"Review Pending"},"child_stores":[],"price_code_list":{"album":[],"track":[]},"price_code":{"track_price_id":0,"album_price_id":0}},{"process_duration_dates":10,"release_start_date":"31-07-2023","store_name":"Slacker","is_presales_date_enabled":false,"pre_sales_date":"","release_end_date":"","store_id":4419,"outlet_status":{"status_code":1207,"status_name":"Review Pending"},"child_stores":[],"price_code_list":{"album":[],"track":[]},"price_code":{"track_price_id":0,"album_price_id":0}},{"process_duration_dates":10,"release_start_date":"31-07-2023","store_name":"SoundCloud Go","is_presales_date_enabled":false,"pre_sales_date":"","release_end_date":"","store_id":4420,"outlet_status":{"status_code":1207,"status_name":"Review Pending"},"child_stores":[],"price_code_list":{"album":[],"track":[]},"price_code":{"track_price_id":0,"album_price_id":0}},{"process_duration_dates":10,"release_start_date":"31-07-2023","store_name":"Spotify","is_presales_date_enabled":false,"pre_sales_date":"","release_end_date":"","store_id":4421,"outlet_status":{"status_code":1207,"status_name":"Review Pending"},"child_stores":[],"price_code_list":{"album":[],"track":[]},"price_code":{"track_price_id":0,"album_price_id":0}},{"process_duration_dates":10,"release_start_date":"31-07-2023","store_name":"Tencent","is_presales_date_enabled":false,"pre_sales_date":"","release_end_date":"","store_id":4422,"outlet_status":{"status_code":1207,"status_name":"Review Pending"},"child_stores":["KuGou","Kuwo","QQ Music","Ultimate Music","WeSing"],"price_code_list":{"album":[],"track":[]},"price_code":{"track_price_id":0,"album_price_id":0}},{"process_duration_dates":10,"release_start_date":"31-07-2023","store_name":"Tidal","is_presales_date_enabled":false,"pre_sales_date":"","release_end_date":"","store_id":4423,"outlet_status":{"status_code":1207,"status_name":"Review Pending"},"child_stores":[],"price_code_list":{"album":[],"track":[]},"price_code":{"track_price_id":0,"album_price_id":0}},{"process_duration_dates":10,"release_start_date":"31-07-2023","store_name":"TikTok","is_presales_date_enabled":false,"pre_sales_date":"","release_end_date":"","store_id":4424,"outlet_status":{"status_code":1207,"status_name":"Review Pending"},"child_stores":["Douyin","Resso"],"price_code_list":{"album":[],"track":[]},"price_code":{"track_price_id":0,"album_price_id":0}},{"process_duration_dates":10,"release_start_date":"31-07-2023","store_name":"Transsnet Boomplay","is_presales_date_enabled":false,"pre_sales_date":"","release_end_date":"","store_id":4426,"outlet_status":{"status_code":1207,"status_name":"Review Pending"},"child_stores":[],"price_code_list":{"album":[],"track":[]},"price_code":{"track_price_id":0,"album_price_id":0}},{"process_duration_dates":10,"release_start_date":"31-07-2023","store_name":"Tuned Global","is_presales_date_enabled":false,"pre_sales_date":"","release_end_date":"","store_id":4427,"outlet_status":{"status_code":1207,"status_name":"Review Pending"},"child_stores":["Deedo","TrackDrip"],"price_code_list":{"album":[],"track":[]},"price_code":{"track_price_id":0,"album_price_id":0}},{"process_duration_dates":10,"release_start_date":"31-07-2023","store_name":"Turkcell Fizy","is_presales_date_enabled":false,"pre_sales_date":"","release_end_date":"","store_id":4428,"outlet_status":{"status_code":1207,"status_name":"Review Pending"},"child_stores":[],"price_code_list":{"album":[],"track":[]},"price_code":{"track_price_id":0,"album_price_id":0}},{"process_duration_dates":10,"release_start_date":"31-07-2023","store_name":"United Media Agency","is_presales_date_enabled":false,"pre_sales_date":"","release_end_date":"","store_id":4429,"outlet_status":{"status_code":1207,"status_name":"Review Pending"},"child_stores":[],"price_code_list":{"album":[],"track":[]},"price_code":{"track_price_id":0,"album_price_id":0}},{"process_duration_dates":10,"release_start_date":"31-07-2023","store_name":"Yandex Music","is_presales_date_enabled":false,"pre_sales_date":"","release_end_date":"","store_id":4430,"outlet_status":{"status_code":1207,"status_name":"Review Pending"},"child_stores":[],"price_code_list":{"album":[],"track":[]},"price_code":{"track_price_id":0,"album_price_id":0}},{"process_duration_dates":10,"release_start_date":"31-07-2023","store_name":"Zvooq","is_presales_date_enabled":false,"pre_sales_date":"","release_end_date":"","store_id":4431,"outlet_status":{"status_code":1207,"status_name":"Review Pending"},"child_stores":[],"price_code_list":{"album":[],"track":[]},"price_code":{"track_price_id":0,"album_price_id":0}},{"process_duration_dates":10,"release_start_date":"31-07-2023","store_name":"Hungama","is_presales_date_enabled":false,"pre_sales_date":"","release_end_date":"","store_id":4432,"outlet_status":{"status_code":1207,"status_name":"Review Pending"},"child_stores":[],"price_code_list":{"album":[],"track":[]},"price_code":{"track_price_id":0,"album_price_id":0}}]}"""
        val result: DistributionOutletReleaseStatusResponse = json.decodeFromString(jsonString)
        assertThat(result.outletReleaseStatuses?.size).isEqualTo(38)
        // println(result.toString())
    }

    @Test
    fun `test SQS message receive`() {
        val jsonString =
            """
            {"songId":"ad2b5937-d9bf-407f-ba9a-74e007cfa718","mintingStatus":"Pending"}
            """.trimIndent()
        val mintingStatusSqsMessage: MintingStatusSqsMessage = json.decodeFromString(jsonString)
        println(mintingStatusSqsMessage.toString())
    }

    @Test
    fun `test GetAlbumResponse`() {
        val jsonString =
            """
            {"message":"Currently showing 1 record(s)","success":true,"total_records":1,"data":[{"cover_image":"https://s3.amazonaws.com/eveara-bucket/production/contents/306264/100000688773/album_art/100000688773_THUMB.JPG?AWSAccessKeyId=AKIA56KZMVANEUHP7T5B&Expires=1707611649&Signature=IyFiRcd8iECZUIsdOHl%2Bm4P9AF4%3D","subscription":{"expiration_date":"","subscription_id":312153,"subscription_name":"NEWMUnlimited"},"ean_upc":5063332716402,"is_active":1,"product_format":"Stereo","original_release_date":"31-01-2024","name":"Bosquet Bohemien","release_id":100000688773,"spatial_ean_upc":"","pre_save_link":"","tracks":[{"album_track_id":666654,"participant":[{"participant_id":256028,"participant_name":"NEWM","roles":[{"role_id":5,"role_name":"Publisher"}],"payout_share_percentage":100},{"participant_id":256029,"participant_name":"L'alchimiste","roles":[{"role_id":6,"role_name":"Artist"}],"payout_share_percentage":0}],"iswc":"","featured_artists":[],"spatial_isrc":"","artists":[{"id":312819,"name":"L'alchimiste"}],"isrc":"IEWNY2405094","preview":{"start_at":0,"duration":30},"outlets":[{"outlet_name":"Apple Music","outlet_id":"1726731390"}],"track_id":678294,"name":"Bosquet Bohemien"}],"product_type":"Single","album_status":{"status_code":1023,"status_name":"Released"},"artist":[{"artist_id":312819,"artist_name":"L'alchimiste"}],"spatial_product_code_type":"","disapprove_message":"","product_code_type":"EAN","outlets":[{"outlet_name":"Apple Music","outlet_id":"1726731389"}],"removable":"false","track_count":1}]}
            """.trimIndent()

        val response: GetAlbumResponse = json.decodeFromString(jsonString)
        println(response.toString())
    }
}
