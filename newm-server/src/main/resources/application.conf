ktor {
    development = false
    deployment {
        port = 3939
        port = ${?PORT}
        connectionIdleTimeoutSeconds = 30
        parallelism = 12
        connectionGroupSize = 13
        workerGroupSize = 13
        callGroupSize = 24
        cookieDomain = "newm.io"
        cookieDomain = ${?COOKIE_DOMAIN}
    }
    application {
        modules = [io.newm.server.ApplicationKt.module]
    }
}

oauth {
    google {
        clientId = ${AWS_SECRET_ARN}
        clientSecret = ${AWS_SECRET_ARN}
        accessTokenUrl = "https://accounts.google.com/o/oauth2/token"
        userInfoUrl = "https://www.googleapis.com/oauth2/v2/userinfo"
    }
    facebook {
        clientId = ${AWS_SECRET_ARN}
        clientSecret = ${AWS_SECRET_ARN}
        accessTokenUrl = "https://graph.facebook.com/oauth/access_token"
        userInfoUrl = "https://graph.facebook.com/v13.0/me"
    }
    linkedin {
        clientId = ${AWS_SECRET_ARN}
        clientSecret = ${AWS_SECRET_ARN}
        accessTokenUrl = "https://www.linkedin.com/oauth/v2/accessToken"
        userInfoUrl = "https://api.linkedin.com/v2/me"
        userExtraInfoUrl = "https://api.linkedin.com/v2/clientAwareMemberHandles"
    }
    apple {
        clientId = ${AWS_SECRET_ARN}
        clientSecret = ${AWS_SECRET_ARN}
        accessTokenUrl = "https://appleid.apple.com/auth/token"
        publicKeysUrl = "https://appleid.apple.com/auth/keys"
        audiences = ${AWS_SECRET_ARN}
    }
}

jwt {
    realm = "NEWM Server"
    issuer = "https://newm.io"
    audience = "newm-server-users"
    secret = ${AWS_SECRET_ARN}
    cacheSize = 10
    cacheExpiresIn = 24
    access {
        timeToLive = 3600
    }
    refresh {
        timeToLive = 604800
    }
}

email {
    enabled = true
    smtpHost = ${AWS_SECRET_ARN}
    smtpPort = ${EMAIL_SMTP_PORT}
    sslOnConnect = true
    userName = ${AWS_SECRET_ARN}
    password = ${AWS_SECRET_ARN}
    from = ${AWS_SECRET_ARN}
}

twoFactorAuth {
    codeSize = 6
    timeToLive = 300
    email {
        subject = "NEWM Verification Code"
        messageUrl = "/email/2fa-code.html"
        messageUrl = ${?EMAIL_2FA_MESSAGE_URL}
    }
}

database {
    driverClassName = org.postgresql.Driver
    jdbcUrl = ${AWS_SECRET_ARN}
    username = ${AWS_SECRET_ARN}
    password = ${AWS_SECRET_ARN}
}

cors {
    hosts = [${CORS_HOSTS}]
}

sentry {
    dsn = ${SENTRY_DSN}
}

cloudinary {
    url = ${CLOUDINARY_URL}
}

aws {
    region = ${AWS_REGION}
    s3 {
        audio {
            bucketName = ${AWS_AUDIO_BUCKET}
            timeToLive = 180
            maxUploadSizeMB = 500
            minUploadSizeMB = 1
        }
        agreement {
            bucketName = ${AWS_AGREEMENT_BUCKET}
            fileName = "StreamTokenAgreement.pdf"
        }
    }
    sqs {
        audio {
            queueUrl = ${AWS_AUDIO_SQS_QUEUE_URL}
            waitTime = 20
            delayTimeMs = 1000
            receiver = io.newm.server.features.song.AudioMessageReceiver
        }
        minting {
            queueUrl = ${AWS_MINTING_SQS_QUEUE_URL}
            waitTime = 20
            delayTimeMs = 1000
            receiver = io.newm.server.features.minting.MintingMessageReceiver
        }
    }
    cloudFront {
        audioStream {
            hostUrl = ${AWS_AUDIO_CLOUDFRONT_HOST_URL}
            keyPairId = ${AWS_SECRET_ARN}
            privateKey = ${AWS_SECRET_ARN}
        }
    }
    kms {
        keyId = ${AWS_SECRET_ARN}
    }
}

idenfy {
    apiKey = ${AWS_SECRET_ARN}
    apiSecret = ${AWS_SECRET_ARN}
    sessionUrl = "https://ivs.idenfy.com/api/v2/token"

    signature {
        key = ${AWS_SECRET_ARN}
        algorithm = "HmacSHA256"
    }
    email {
        subject = "NEWM Identity Verification Status"
        verifiedMessageUrl = "/email/kyc-verified.html"
        verifiedMessageUrl = ${?EMAIL_KYC_VERIFIED_MESSAGE_URL}
        unverifiedMessageUrl = "/email/kyc-unverified.html"
        unverifiedMessageUrl = ${?EMAIL_KYC_UNVERIFIED_MESSAGE_URL}
        pendingMessageUrl = "/email/kyc-pending.html"
        pendingMessageUrl = ${?EMAIL_KYC_PENDING_MESSAGE_URL}
    }
}

arweave {
    scheme = "https"
    host = "arweave.net"
    walletJson = ${ARWEAVE_WALLET_JSON}
}

eveara {
    server = ${EVEARA_SERVER}
    clientId = ${AWS_SECRET_ARN}
    clientSecret = ${AWS_SECRET_ARN}
}

newmChain {
    host = ${NEWM_CHAIN_HOST}
    port = 3737
    port = ${?NEWM_CHAIN_PORT}
    jwt = ${AWS_SECRET_ARN}
    secure = true
    secure = ${?NEWM_CHAIN_SECURE}
}

collaboration {
    email {
        subject = "NEWM Collaboration Invitation"
        messageUrl = "/email/collab-invitation.html"
        messageUrl = ${?EMAIL_COLLAB_INVITATION_MESSAGE_URL}
    }
}

mintingNotifications {
    started {
        subject = "NEWM Song Minting Started"
        messageUrl = "/email/mint-started.html"
        messageUrl = ${?EMAIL_MINT_STARTED_MESSAGE_URL}
    }
    succeeded {
        subject = "NEWM Song Minting Succeeded"
        messageUrl = "/email/mint-succeeded.html"
        messageUrl = ${?EMAIL_MINT_SUCCEDED_MESSAGE_URL}
    }
    failed {
        subject = "NEWM Song Minting Failed"
        messageUrl = "/email/mint-failed.html"
        messageUrl = ${?EMAIL_MINT_FAILED_MESSAGE_URL}
    }
}
